<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>List Students</title>


	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>




<body onload="loadStudents()">
	<form id="registerUser">
		<label for="name">First Name:</label>
		<input type="text" id="fName" name="fName" required><br>

		<label for="age">Last Name:</label>
		<input type="text" id="lName" name="lName" required><br>

		<label for="major">Street Number:</label>
		<input type="int" id="streetNumber" name="streetNumber" required><br>
		
		<label for="major">Street Name:</label>
		<input type="int" id="streetName" name="streetName" required><br>
		
		<label for="major">City:</label>
		<input type="text" id="city" name="city" required><br>
		
		<label for="major">Country:</label>
		<input type="text" id="country" name="country" required><br>
		
		<label for="major">Postal Code:</label>
		<input type="text" id="postalCode" name="postalCode" required><br>
		
		<label for="major">Email</label>
		<input type="text" id="email" name="email" required><br>
		
		<label for="major">Create username</label>
		<input type="text" id="username" name="username" required><br>
		
		<label for="major">Create password</label>
		<input type="text" id="password" name="password" required><br>

		<input type="submit" value="Add Student">
	</form>


	<p id="confirmationMessage"></p>

	

	<script>
		
        $("#registerUser").submit(function (e) {
            e.preventDefault();
            var studentData = {
                fName: $("#fName").val(),
   		 		lName: $("#lName").val(),
    			streetNumber: $("#streetNumber").val(),
    			streetName: $("#streetName").val(),
    			city: $("#city").val(),
    			country: $("#country").val(),
    			postalCode: $("#postalCode").val(),
    			email: $("#email").val(),
    			username: $("#username").val(),
    			password: $("#password").val()
				
            };
                $.ajax({
                url: "http://localhost:8080/EECS4413Project/signup",
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(studentData),
                success: function (result) {
                    $("#confirmationMessage").text("Student added successfully!");
                },
                error: function (error) {
                    console.log(error);
                }
            });
           
            
        });
		function validateAndSubmitForm(event) {
			event.preventDefault();

			// Client-side validation
			const name = $("#name").val();
			const age = parseInt($("#age").val());

			if (name.length > 25) {
				displayMessage('Name should be less than 25 characters.'); // text length < 25 characters;
			} else if (isNaN(age) || age < 19 || age > 99) {
				displayMessage('Age should be a number between 19 and 99.'); // age input should be Integer, > 18 and < 100
			} else {
				// If validation passed, make an asynchronous request to the server
				submitForm(name, age);
			}
		}

		function submitForm(name, age) {
			// Use asynchronous request to submit the form data to the server
			$.ajax({
				url: "http://localhost:8080/StudentInformationSystem/api/enroll",
				type: 'POST',
				contentType: 'application/json',
				data: JSON.stringify({name, age}),
				success: function (result) {
					if (result.error) {
						displayMessage(result.error);
					} else {
						displayMessage('Student enrolled successfully.');
						// Update the student table w/ new data
						loadStudents();
					}
				},
				error: function (error) {
					console.log(error);
				}
			});
		}

		function loadStudents() {
			// Use asynchronous request to get existing students from the server
			$.ajax({
				url: "http://localhost:8080/StudentInformationSystem/api/students",
				type: 'GET',
				success: function (data) {
					// Update the student table with the received data
					updateStudentTable(data);
				},
				error: function (error) {
					console.error('Error fetching students:', error);
				}
			});
		}

		function updateStudentTable(students) { // using the append method in class notes
			const table = $("#studentTable");

			// Clear existing rows
			table.find("tr:gt(0)").remove();


			students.forEach(student => {
				const row = $("<tr>");
				row.append($("<td>").text(student.id));
				row.append($("<td>").text(student.name));
				row.append($("<td>").text(student.age));
				row.append($("<td>").text(student.major));
				table.append(row);
			});
		}

		function displayMessage(message) {
			$("#confirmationMessage").text(message);
		}


	</script>
</body>

</html>